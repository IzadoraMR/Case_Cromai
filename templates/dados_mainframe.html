<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dados_mainframe.css') }}">
    <title>Mainframe</title>
</head>
<body>
    <nav class="navbar ">
        <div class="container-fluid">
            <h1 class="navbar-brand mx-auto custom-font-size" href="#">Mainframe</h1>
            <form action="{{ url_for('logout') }}" method="post" class="form-inline">
                <input type="submit" class="btn btn-primary btn-lg" value="Logout">
            </form>
        </div>
    </nav>
    
    
    

    <div class="custom-container ">
        <div class="row p-3 d-flex align-items-stretch">
            <div class="col-md-8 p-3 col-sm-12">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="text-center ">Informações da CPU</h3>
                        <div class="row">
                            <div class="col-md-6 col-sm-12">
                                <div class="">
                                    <div class="col-md-12 col-sm-12">
                                        <h3 class="progress-title">CPU1</h3>
                                        <div class="progress">
                                            <div id="cpu1-bar" class="progress-bar cpu1" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                                <span id="cpu1-text">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-sm-12">
                                        <h3 class="progress-title">CPU2</h3>
                                        <div class="progress">
                                            <div id="cpu2-bar" class="progress-bar cpu2" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                            <span id="cpu2-text">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="">
                                    <div class="col-md-12 col-sm-12">
                                        <h3 class="progress-title">CPU3</h3>
                                        <div class="progress">
                                            <div id="cpu3-bar" class="progress-bar cpu3" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                                <span id="cpu3-text">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-sm-12">
                                        <h3 class="progress-title">CPU4</h3>
                                        <div class="progress">
                                            <div id="cpu4-bar" class="progress-bar cpu4" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                                <span id="cpu4-text">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <div class="col-md-12 col-sm-12">
                                        <h3 class="progress-title">CPU Total</h3>
                                        <div class="progress">
                                            <div id="totalcpu-bar" class="progress-bar cput custom-progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                                <span id="totalcpu-text">0%</span>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                            <div class="col-md-6 col-sm-12">
                              <div id="cpu-chart" class="plotly-container"></div>
                            </div>
                        </div>    
                    </div>
                    </div>
                
            </div>
            <div class="col-md-4 h-100 p-3 col-sm-12">
                <div class="card" >
                    <div class="card-body ">
                        <h3 class="text-center ">Informações do Disco</h3>
                        <div class="col-md-10 mx-auto">
                            <div class="card sub-card ">
                                <div class="card-body">
                                    <h3 class="progress-title">Disco</h3>
                                    <div class="progress">
                                        <div id="usodiscop-bar" class="progress-bar disco" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                            <span id="usodiscop-text">0%</span>
                                        </div>
                                    </div>
                                    <div class="row text-center mt-4">
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="tamdisco-text">0G</div>
                                            <span class="small text-gray">Total</span>
                                        </div>
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="usodisco-text">0G</div>
                                            <span class="small text-gray">Usado</span>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 font-weight-bold mb-0" id="dispdisco-text">0G</div>
                                            <span class="small text-gray">Disponível</span>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>

                        </div>
                        <div id="disco-chart"></div>
                    </div>
                </div>
                
            </div>
            
            <div class="col-md-12 p-3 col-sm-12 ">
                
                <div class="card" >
                    <div class="card-body ">
                        <h3 class="text-center p-3">Informações da Memória</h3>
                        <div class="row">
                            
                            <div class="col-md-6 mx-auto col-sm-12">
                            <div class="card sub-card ">
                                <div class="card-body">
                                    <h3 class="progress-title">Memória</h3>
                                    <div class="progress">
                                        <div id="pmemusada-bar" class="progress-bar memoria" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                            <span id="porcent_mem_Usada">0%</span>
                                        </div>
                                    </div>
                                    <div class="row text-center mt-4">
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="memtotal">0M</div>
                                            <span class="small text-gray">Total</span>
                                        </div>
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="memusada">0M</div>
                                            <span class="small text-gray">Usado</span>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 font-weight-bold mb-0" id="memlivre">0M</div>
                                            <span class="small text-gray">Livre</span>
                                        </div>
                                    </div>
                                    <div class="row text-center mt-4">
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="memcompart">0M</div>
                                            <span class="small text-gray">Compartilhada</span>
                                        </div>
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="memcache">0M</div>
                                            <span class="small text-gray">buff/cache</span>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 font-weight-bold mb-0" id="memdispo">0M</div>
                                            <span class="small text-gray">Disponível</span>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            <div id="memoria-chart"></div>

                        </div>
                        <div class="col-md-6 mx-auto col-sm-12">
                            <div class="card sub-card">
                                <div class="card-body">
                                    <h3 class="progress-title">Swap</h3>
                                    <div class="progress">
                                        <div id="pswapsada-bar" class="progress-bar swap" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                                            <span id="porcent_swap_Usada">0%</span>
                                        </div>
                                    </div>
                                    <div class="row text-center mt-4">
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="swaptotal">0M</div>
                                            <span class="small text-gray">Total</span>
                                        </div>
                                        <div class="col-4 border-right">
                                            <div class="h5 font-weight-bold mb-0" id="swapusada">0M</div>
                                            <span class="small text-gray">Usado</span>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 font-weight-bold mb-0" id="swaplivre">0M</div>
                                            <span class="small text-gray">Livre</span>
                                        </div>
                                    </div>
                                    <div class="row text-center mt-4"></div>
                                    <div class="row text-center mt-4"></div>
                                    <div class="row text-center mt-4"></div>
                                </div>
                                
                            </div><div id="swap-chart"></div>
                        </div>
                        
                        </div>

                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function updateCPUInfo() {
            $.ajax({
                url: 'http://localhost:5000/get_system_data',  
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                
                var memTotal = data.memTotal;
                var memUsada = data.memUsada;
                var porcent_mem_Usada = ((memUsada / memTotal) * 100)
                var porcent_swap_Usada = ((data.swapUsada / data.swapTotal) * 100)
                $('#cpu1-bar').css('width', data.CPU1 + '%');
                $('#cpu1-bar').attr('aria-valuenow', data.CPU1);
                $('#cpu1-text').text(data.CPU1 + '%');

                $('#cpu2-bar').css('width', data.CPU2 + '%');
                $('#cpu2-bar').attr('aria-valuenow', data.CPU2);
                $('#cpu2-text').text(data.CPU2 + '%');

                $('#cpu3-bar').css('width', data.CPU3 + '%');
                $('#cpu3-bar').attr('aria-valuenow', data.CPU3);
                $('#cpu3-text').text(data.CPU3 + '%');

                $('#cpu4-bar').css('width', data.CPU4 + '%');
                $('#cpu4-bar').attr('aria-valuenow', data.CPU4);
                $('#cpu4-text').text(data.CPU4 + '%');

                $('#totalcpu-bar').css('width', data.TotalCPU + '%');
                $('#totalcpu-bar').attr('aria-valuenow', data.TotalCPU);
                $('#totalcpu-text').text(data.TotalCPU + '%');

                $('#usodiscop-bar').css('width', data.UsoDiscoP);
                $('#usodiscop-bar').attr('aria-valuenow', data.UsoDiscoP);

                $('#pmemusada-bar').css('width', porcent_mem_Usada + '%'); 
                $('#pmemusada-bar').attr('aria-valuenow', porcent_mem_Usada); 

                $('#pswapsada-bar').css('width', porcent_swap_Usada + '%'); 
                $('#pswapsada-bar').attr('aria-valuenow', porcent_swap_Usada); 

                $('#usodiscop-text').text(data.UsoDiscoP  + '%' );

                $('#tamdisco-text').text(data.TamDisco + 'G');

                $('#usodisco-text').text(data.UsoDisco + 'G');

                $('#dispdisco-text').text(data.dispDisco + 'G');

                
                $('#cpu1').text(data.CPU1);
                $('#cpu2').text(data.CPU2);
                $('#cpu3').text(data.CPU3);
                $('#cpu4').text(data.CPU4);
                $('#totalcpu').text(data.TotalCPU + 'G');
                $('#tamdisco').text(data.TamDisco + 'G');
                $('#usodisco').text(data.UsoDisco + 'G');
                $('#usodiscop').text(data.UsoDiscoP );
                $('#dispdisco').text(data.dispDisco);
                $('#memtotal').text(data.memTotal + 'M');
                $('#memusada').text(data.memUsada + 'M');
                $('#memlivre').text(data.memLivre + 'M');
                $('#memcompart').text(data.memCompart + 'M');
                $('#memcache').text(data.memCache + 'M');
                $('#memdispo').text(data.memDispo + 'M');
                $('#swaptotal').text(data.swapTotal+ 'M');
                $('#swapusada').text(data.swapUsada+ 'M');
                $('#swaplivre').text(data.swapLivre+ 'M');
                $('#porcent_mem_Usada').text(porcent_mem_Usada.toFixed(2) + '%');
                $('#porcent_swap_Usada').text(porcent_swap_Usada.toFixed(2) + '%');

                }
            });
        }

        
        setInterval(updateCPUInfo, 1000);
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        var chartDiv = document.getElementById('cpu-chart');
        var chart;

        function updateChart() {
            $.ajax({
                url: '/cpu-data',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (!chart) {
                        chart = Plotly.newPlot(chartDiv, [{
                            x: data.timestamp,
                            y: data.cpu_usage,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'CPU Usage'
                        }], {
                            yaxis: { range: [0, 100] },
                            title: 'Uso da CPU (60s)',
                                margin: { t: 30, b: 30, l: 30, r: 30}
                        },
                        config = {
                            displayModeBar: false, 
                            displaylogo: false,   
                            scrollZoom: false,    
                            showTips: false       
                        });
                    } else {
                        Plotly.update(chartDiv, {
                            x: [data.timestamp],
                            y: [data.cpu_usage]
                        }, {
                            'xaxis.tickvals': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]],
                            'xaxis.ticktext': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]]
                        });
                    }
                }
            });
        }
        setInterval(updateChart, 1200);

    </script>
    <script>
        var chartDivDisco = document.getElementById('disco-chart');
        var chartDisco;

        function updateChartDisco() {
            $.ajax({
                url: '/disco-data',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (!chartDisco) {
                        chartDisco = Plotly.newPlot(chartDivDisco, [{
                            x: data.timestamp,
                            y: data.disco_usage,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Disco Usage'
                        }], {
                            
                            
                            yaxis: { range: [0, 100] },
                            title: 'Uso do Disco (60s)',
                                margin: { t: 30, b: 30, l: 30, r: 30}
                            
                            
                        },
                        config = {
                            displayModeBar: false, 
                            displaylogo: false,   
                            scrollZoom: false,    
                            showTips: false       
                        });
                    } else {
                        
                        Plotly.update(chartDivDisco, {
                            x: [data.timestamp],
                            y: [data.disco_usage]
                        }, {
                            'xaxis.tickvals': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]],
                            'xaxis.ticktext': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]]
                        });
                    }
                }
            });
        }
        setInterval(updateChartDisco, 1000);

    </script>
    <script>
        var chartDivMemoria = document.getElementById('memoria-chart');
        var chartMemoria;

        function updateChartMemoria() {
            $.ajax({
                url: '/memoria-data',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (!chartMemoria) {
                        chartMemoria = Plotly.newPlot(chartDivMemoria, [{
                            x: data.timestamp,
                            y: data.memoria_usage,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Memoria Usage'
                        }], {
                           
                            
                            yaxis: { range: [0, 100] },
                            title: 'Uso da Memória (60s)',
                        },
                        config = {
                            displayModeBar: false, 
                            displaylogo: false,   
                            scrollZoom: false,    
                            showTips: false       
                        });
                    } else {
                        Plotly.update(chartDivMemoria, {
                            x: [data.timestamp],
                            y: [data.memoria_usage]
                        }, {
                            'xaxis.tickvals': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]],
                            'xaxis.ticktext': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]]
                        });
                    }
                }
            });
        }
        setInterval(updateChartMemoria, 1000);

    </script>
    <script>
        var chartDivSwap = document.getElementById('swap-chart');
        var chartSwap;

        function updateChartSwap() {
            $.ajax({
                url: '/swap-data',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (!chartSwap) {
                        chartSwap = Plotly.newPlot(chartDivSwap, [{
                            x: data.timestamp,
                            y: data.swap_usage,
                            type: 'scatter',
                            mode: 'lines',
                            name: 'Swap Usage'
                        }], {
                            yaxis: { range: [0, 100] },
                            title: 'Uso do Swap (60s)',
                        },
                        config = {
                            displayModeBar: false, 
                            displaylogo: false,   
                            scrollZoom: false,    
                            showTips: false       
                        });
                    } else {
                        
                        Plotly.update(chartDivSwap, {
                            x: [data.timestamp],
                            y: [data.swap_usage]
                        }, {
                            'xaxis.tickvals': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]],
                            'xaxis.ticktext': [data.timestamp[0], data.timestamp[data.timestamp.length - 1]]
                        });
                    }
                }
            });
        }
        setInterval(updateChartSwap, 1000);

    </script>
    

</body>
</html>
